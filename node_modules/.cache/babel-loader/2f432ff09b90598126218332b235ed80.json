{"ast":null,"code":"import _defineProperty from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import SectionHeader from'../../components/SectionHeader';import Button from'../../components/Button';import ExpensesSection from'./ExpensesSection';import{client}from'../../util/roger-api-client';import groupBy from'lodash/groupBy';import transform from'lodash/transform';import uuid from'uuid';import{useIsMounted}from'../../hooks/useIsMounted';import Spinner from'../../components/Spinner';import ErrorPanel from'../../components/ErrorPanel';import{useForceRef}from'../../hooks/useForceRef';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var UploadInput=_styled.input.withConfig({displayName:\"ExpenseListRoute__UploadInput\",componentId:\"sc-18y3qim-0\"})([\"display:none;\"]);export var ExpenseListRoute=function ExpenseListRoute(){var isMounted=useIsMounted();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var uploadInputRef=useRef(null);var _useForceRef=useForceRef([]),_useForceRef2=_slicedToArray(_useForceRef,2),getItemsRef=_useForceRef2[0],setItems=_useForceRef2[1];var _useForceRef3=useForceRef({}),_useForceRef4=_slicedToArray(_useForceRef3,2),getUploadingFilesRef=_useForceRef4[0],setUploadingFiles=_useForceRef4[1];var handleAnalyzed=useCallback(function(expense){var oldItemIdx=getItemsRef().current.findIndex(function(item){return item.id===expense.id;});if(oldItemIdx===-1){return;}var newItems=_toConsumableArray(getItemsRef().current);newItems.splice(oldItemIdx,1,expense);setItems(newItems);},[getItemsRef,setItems]);useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var expenses;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setError(undefined);setIsLoading(true);_context.prev=2;_context.next=5;return client.listExpenses();case 5:expenses=_context.sent;setItems(expenses);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);setError(_context.t0);case 12:_context.prev=12;isMounted&&setIsLoading(false);return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,9,12,15]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[isMounted,setIsLoading,setError,setItems]);useEffect(function(){client.on('expenseAnalyzed',handleAnalyzed);return function(){client.off('expenseAnalyzed',handleAnalyzed);};},[handleAnalyzed]);var handleUploadExpenses=useCallback(function(){if(!uploadInputRef.current){return;}uploadInputRef.current.click();},[]);var handleUploadInternal=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(evt){var newFile,fileId,expense;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(evt.target.files){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:newFile=evt.target.files[0];fileId=uuid();setUploadingFiles(_objectSpread(_objectSpread({},getUploadingFilesRef().current),{},_defineProperty({},fileId,newFile)));setError(undefined);_context2.prev=6;_context2.next=9;return client.uploadExpense(newFile);case 9:expense=_context2.sent;setItems([].concat(_toConsumableArray(getItemsRef().current),[expense]));_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](6);setError(_context2.t0);case 16:_context2.prev=16;setUploadingFiles(_objectSpread(_objectSpread({},getUploadingFilesRef().current),{},_defineProperty({},fileId,undefined)));return _context2.finish(16);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[6,13,16,19]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[getItemsRef,getUploadingFilesRef,setUploadingFiles,setItems,setError]);var groupedItems=useMemo(function(){return groupBy(getItemsRef().current,function(item){return item.status;});},[getItemsRef]);var uploadingItems=useMemo(function(){return transform(getUploadingFilesRef().current,function(acc,item,id){if(!item){return acc;}acc.push({id:id,filename:item.name});return acc;},[]);},[getUploadingFilesRef]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(SectionHeader,{title:\"Expenses\",children:[/*#__PURE__*/_jsx(UploadInput,{ref:uploadInputRef,onChange:handleUploadInternal,type:\"file\",id:\"file\"}),/*#__PURE__*/_jsx(Button,{onClick:handleUploadExpenses,children:\"Upload expenses\"})]}),error&&/*#__PURE__*/_jsx(ErrorPanel,{text:error.message}),!isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ExpensesSection,{title:\"Uploading\",showLoading:true,hideViewExpenseButton:true,items:uploadingItems.length?uploadingItems:undefined}),/*#__PURE__*/_jsx(ExpensesSection,{title:\"Analyzing\",showLoading:true,items:groupedItems.ANALYZING}),/*#__PURE__*/_jsx(ExpensesSection,{title:\"Unpaid\",items:groupedItems.UNPAID}),/*#__PURE__*/_jsx(ExpensesSection,{title:\"Paid\",items:groupedItems.PAID})]}):/*#__PURE__*/_jsx(Spinner,{})]});};export default ExpenseListRoute;","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","SectionHeader","Button","ExpensesSection","client","groupBy","transform","uuid","useIsMounted","Spinner","ErrorPanel","useForceRef","UploadInput","styled","input","ExpenseListRoute","isMounted","isLoading","setIsLoading","error","setError","uploadInputRef","getItemsRef","setItems","getUploadingFilesRef","setUploadingFiles","handleAnalyzed","expense","oldItemIdx","current","findIndex","item","id","newItems","splice","fetchData","undefined","listExpenses","expenses","on","off","handleUploadExpenses","click","handleUploadInternal","evt","target","files","newFile","fileId","uploadExpense","groupedItems","status","uploadingItems","acc","push","filename","name","message","length","ANALYZING","UNPAID","PAID"],"sources":["/Users/macbook/Desktop/corpayone-michael-two/src/pages/expenses/ExpenseListRoute.tsx"],"sourcesContent":["import React, {useCallback, useEffect, useMemo, useRef, useState} from 'react'\nimport SectionHeader from '../../components/SectionHeader'\nimport Button from '../../components/Button'\nimport ExpensesSection from './ExpensesSection'\nimport {client, Expense} from '../../util/roger-api-client'\nimport groupBy from 'lodash/groupBy'\nimport transform from 'lodash/transform'\nimport styled from 'styled-components/macro'\nimport uuid from 'uuid'\nimport {useIsMounted} from '../../hooks/useIsMounted'\nimport Spinner from '../../components/Spinner'\nimport ErrorPanel from '../../components/ErrorPanel'\nimport {useForceRef} from '../../hooks/useForceRef'\n\nconst UploadInput = styled.input`\n  display: none;\n`\n\nexport const ExpenseListRoute: React.FC<{}> = () => {\n  const isMounted = useIsMounted()\n  const [isLoading, setIsLoading] = useState<boolean>(false)\n  const [error, setError] = useState<Error>()\n  const uploadInputRef = useRef<HTMLInputElement>(null)\n  const [getItemsRef, setItems] = useForceRef<Expense[]>([])\n  const [getUploadingFilesRef, setUploadingFiles] = useForceRef<{\n    [id: string]: File | undefined\n  }>({})\n\n  const handleAnalyzed = useCallback(\n    (expense: Expense) => {\n      const oldItemIdx = getItemsRef().current.findIndex(\n        item => item.id === expense.id\n      )\n      if (oldItemIdx === -1) {\n        return\n      }\n\n      const newItems = [...getItemsRef().current]\n      newItems.splice(oldItemIdx, 1, expense)\n\n      setItems(newItems)\n    },\n    [getItemsRef, setItems]\n  )\n\n  useEffect(() => {\n    const fetchData = async () => {\n      let expenses\n      setError(undefined)\n      setIsLoading(true)\n      try {\n        expenses = await client.listExpenses()\n        setItems(expenses)\n      } catch (e) {\n        setError(e)\n      } finally {\n        isMounted && setIsLoading(false)\n      }\n    }\n    fetchData()\n  }, [isMounted, setIsLoading, setError, setItems])\n\n  useEffect(() => {\n    client.on('expenseAnalyzed', handleAnalyzed)\n\n    return () => {\n      client.off('expenseAnalyzed', handleAnalyzed)\n    }\n  }, [handleAnalyzed])\n\n  const handleUploadExpenses = useCallback(() => {\n    if (!uploadInputRef.current) {\n      return\n    }\n\n    uploadInputRef.current.click()\n  }, [])\n\n  const handleUploadInternal = useCallback(\n    async (evt: React.ChangeEvent<HTMLInputElement>) => {\n      if (!evt.target.files) {\n        return\n      }\n\n      const newFile = evt.target.files[0]\n      const fileId = uuid()\n\n      setUploadingFiles({\n        ...getUploadingFilesRef().current,\n        [fileId]: newFile\n      })\n\n      setError(undefined)\n      let expense\n      try {\n        expense = await client.uploadExpense(newFile)\n        setItems([...getItemsRef().current, expense])\n      } catch (e) {\n        setError(e)\n      } finally {\n        setUploadingFiles({\n          ...getUploadingFilesRef().current,\n          [fileId]: undefined\n        })\n      }\n    },\n    [getItemsRef, getUploadingFilesRef, setUploadingFiles, setItems, setError]\n  )\n\n  const groupedItems = useMemo(() => {\n    return groupBy(getItemsRef().current, (item: Expense) => item.status)\n  }, [getItemsRef])\n\n  const uploadingItems = useMemo(() => {\n    return transform(\n      getUploadingFilesRef().current,\n      (acc: Partial<Expense>[], item: File | undefined, id: string) => {\n        if (!item) {\n          return acc\n        }\n\n        acc.push({\n          id,\n          filename: item.name\n        })\n        return acc\n      },\n      []\n    )\n  }, [getUploadingFilesRef])\n\n  return (\n    <>\n      <SectionHeader title=\"Expenses\">\n        <UploadInput\n          ref={uploadInputRef}\n          onChange={handleUploadInternal}\n          type=\"file\"\n          id=\"file\"\n        />\n        <Button onClick={handleUploadExpenses}>Upload expenses</Button>\n      </SectionHeader>\n      {error && <ErrorPanel text={error.message} />}\n      {!isLoading ? (\n        <>\n          <ExpensesSection\n            title=\"Uploading\"\n            showLoading\n            hideViewExpenseButton\n            items={uploadingItems.length ? uploadingItems : undefined}\n          />\n          <ExpensesSection\n            title=\"Analyzing\"\n            showLoading\n            items={groupedItems.ANALYZING}\n          />\n          <ExpensesSection title=\"Unpaid\" items={groupedItems.UNPAID} />\n          <ExpensesSection title=\"Paid\" items={groupedItems.PAID} />\n        </>\n      ) : (\n        <Spinner />\n      )}\n    </>\n  )\n}\n\nexport default ExpenseListRoute\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}