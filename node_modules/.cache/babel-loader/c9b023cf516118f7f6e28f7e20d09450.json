{"ast":null,"code":"import _objectSpread from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/macbook/Desktop/corpayone-michael-two/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import React,{useCallback,useEffect,useState}from'react';import SectionHeader from'../../components/SectionHeader';import Button from'../../components/Button';import{client,ExpenseStatus}from'../../util/roger-api-client';import{useHistory}from'react-router-dom';import InfoItem from'./InfoItem';import Spinner from'../../components/Spinner';import capitalize from'lodash/capitalize';import{useIsMounted}from'../../hooks/useIsMounted';import ErrorPanel from'../../components/ErrorPanel';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ButtonContainer=_styled.div.withConfig({displayName:\"ExpenseItemRoute__ButtonContainer\",componentId:\"sc-e3e9ev-0\"})([\"display:flex;align-items:center;\"]);var StyledButton=_styled(Button).withConfig({displayName:\"ExpenseItemRoute__StyledButton\",componentId:\"sc-e3e9ev-1\"})([\"margin-left:10px;display:flex;justify-content:center;align-items:center;\"]);var StatusInfo=_styled.span.withConfig({displayName:\"ExpenseItemRoute__StatusInfo\",componentId:\"sc-e3e9ev-2\"})([\"margin-right:10px;\"]);var StatusInfoContainer=_styled.span.withConfig({displayName:\"ExpenseItemRoute__StatusInfoContainer\",componentId:\"sc-e3e9ev-3\"})([\"display:flex;\"]);export var ExpenseItemRoute=function ExpenseItemRoute(_ref){var match=_ref.match;var history=useHistory();var isMounted=useIsMounted();var _useState=useState(),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),expense=_useState4[0],setExpense=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isDeleting=_useState8[0],setIsDeleting=_useState8[1];var id=match.params.id;useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var newExpense;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setError(undefined);_context.prev=1;_context.next=4;return client.getExpense(id);case 4:newExpense=_context.sent;setExpense(newExpense);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);setError(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function fetchData(){return _ref2.apply(this,arguments);};}();fetchData();},[id,setExpense]);var handleAnalyzed=useCallback(function(expense){setExpense(expense);},[setExpense]);useEffect(function(){client.on('expenseAnalyzed',handleAnalyzed);return function(){client.off('expenseAnalyzed',handleAnalyzed);};},[handleAnalyzed]);var handlePay=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var newExpense;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(expense){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:setError(undefined);setIsLoading(true);_context2.prev=4;_context2.next=7;return client.patchExpense(id,_objectSpread(_objectSpread({},expense),{},{status:ExpenseStatus.PAID}));case 7:newExpense=_context2.sent;setExpense(newExpense);_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](4);setError(_context2.t0);case 14:_context2.prev=14;isMounted&&setIsLoading(false);return _context2.finish(14);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[4,11,14,17]]);})),[id,setExpense,expense,setIsLoading,isMounted]);var handleDelete=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var result;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(expense){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:result=window.confirm('Are you sure you want to delete expanse');if(result){_context3.next=5;break;}return _context3.abrupt(\"return\",result);case 5:setError(undefined);setIsDeleting(true);_context3.prev=7;_context3.next=10;return client.deleteExpense(id);case 10:_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](7);setError(_context3.t0);case 15:_context3.prev=15;isMounted&&setIsDeleting(false);history.push('/expenses');return _context3.finish(15);case 19:case\"end\":return _context3.stop();}}},_callee3,null,[[7,12,15,19]]);})),[expense,id,history,isMounted]);var handleShowAll=useCallback(function(){history.push('/expenses');},[history]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SectionHeader,{title:\"Expenses from \".concat(expense&&expense.vendorName?expense.vendorName:'...'),children:expense&&expense.status===ExpenseStatus.UNPAID?/*#__PURE__*/_jsxs(ButtonContainer,{children:[/*#__PURE__*/_jsx(StyledButton,{onClick:handlePay,children:\"Pay\"}),/*#__PURE__*/_jsxs(StyledButton,{onClick:handleDelete,backgroundColor:\"#cd444a\",children:[\"Delete \",isDeleting&&/*#__PURE__*/_jsx(Spinner,{size:\"sm\"})]})]}):/*#__PURE__*/_jsx(StyledButton,{onClick:handleShowAll,children:\"Show all expenses\"})}),error&&/*#__PURE__*/_jsx(ErrorPanel,{text:error.message}),expense?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(InfoItem,{title:'Status',info:/*#__PURE__*/_jsxs(StatusInfoContainer,{children:[/*#__PURE__*/_jsx(StatusInfo,{children:capitalize(expense.status)}),(expense.status===ExpenseStatus.ANALYZING||isLoading)&&/*#__PURE__*/_jsx(Spinner,{size:\"sm\"})]})}),/*#__PURE__*/_jsx(InfoItem,{title:'Vendor',info:expense.vendorName}),/*#__PURE__*/_jsx(InfoItem,{title:'Amount',info:expense.amount}),/*#__PURE__*/_jsx(InfoItem,{title:'Date',info:expense.createdAt&&new Date(expense.createdAt).toLocaleString()}),/*#__PURE__*/_jsx(InfoItem,{title:'Filename',info:expense.filename})]}):/*#__PURE__*/_jsx(Spinner,{})]});};export default ExpenseItemRoute;","map":{"version":3,"names":["React","useCallback","useEffect","useState","SectionHeader","Button","client","ExpenseStatus","useHistory","InfoItem","Spinner","capitalize","useIsMounted","ErrorPanel","ButtonContainer","styled","div","StyledButton","StatusInfo","span","StatusInfoContainer","ExpenseItemRoute","match","history","isMounted","error","setError","expense","setExpense","isLoading","setIsLoading","isDeleting","setIsDeleting","id","params","fetchData","undefined","getExpense","newExpense","handleAnalyzed","on","off","handlePay","patchExpense","status","PAID","handleDelete","result","window","confirm","deleteExpense","push","handleShowAll","vendorName","UNPAID","message","ANALYZING","amount","createdAt","Date","toLocaleString","filename"],"sources":["/Users/macbook/Desktop/corpayone-michael-two/src/pages/expenses-id/ExpenseItemRoute.tsx"],"sourcesContent":["import React, {useCallback, useEffect, useState} from 'react'\nimport SectionHeader from '../../components/SectionHeader'\nimport Button from '../../components/Button'\nimport {client, Expense, ExpenseStatus} from '../../util/roger-api-client'\nimport styled from 'styled-components/macro'\nimport {RouteComponentProps, useHistory} from 'react-router-dom'\nimport InfoItem from './InfoItem'\nimport Spinner from '../../components/Spinner'\nimport capitalize from 'lodash/capitalize'\nimport {useIsMounted} from '../../hooks/useIsMounted'\nimport ErrorPanel from '../../components/ErrorPanel'\n\nconst ButtonContainer = styled.div`\n  display: flex;\n  align-items: center;\n`\n\nconst StyledButton = styled(Button)`\n  margin-left: 10px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`\n\nconst StatusInfo = styled.span`\n  margin-right: 10px;\n`\n\nconst StatusInfoContainer = styled.span`\n  display: flex;\n`\n\ninterface MatchParams {\n  id: string\n}\n\ninterface ExpenseItemProps extends RouteComponentProps<MatchParams> {}\n\nexport const ExpenseItemRoute: React.FC<ExpenseItemProps> = ({match}) => {\n  const history = useHistory()\n  const isMounted = useIsMounted()\n  const [error, setError] = useState<Error>()\n  const [expense, setExpense] = useState<Expense>()\n  const [isLoading, setIsLoading] = useState<boolean>(false)\n  const [isDeleting, setIsDeleting] = useState<boolean>(false)\n  const id = match.params.id\n\n  useEffect(() => {\n    const fetchData = async () => {\n      setError(undefined)\n      try {\n        const newExpense = await client.getExpense(id)\n        setExpense(newExpense)\n      } catch (e) {\n        setError(e)\n      }\n    }\n    fetchData()\n  }, [id, setExpense])\n\n  const handleAnalyzed = useCallback(\n    (expense: Expense) => {\n      setExpense(expense)\n    },\n    [setExpense]\n  )\n\n  useEffect(() => {\n    client.on('expenseAnalyzed', handleAnalyzed)\n\n    return () => {\n      client.off('expenseAnalyzed', handleAnalyzed)\n    }\n  }, [handleAnalyzed])\n\n  const handlePay = useCallback(async () => {\n    if (!expense) {\n      return\n    }\n\n    setError(undefined)\n    setIsLoading(true)\n    try {\n      const newExpense = await client.patchExpense(id, {\n        ...expense,\n        status: ExpenseStatus.PAID\n      })\n      setExpense(newExpense)\n    } catch (e) {\n      setError(e)\n    } finally {\n      isMounted && setIsLoading(false)\n    }\n  }, [id, setExpense, expense, setIsLoading, isMounted])\n\n  const handleDelete = useCallback(async () => {\n    if (!expense) {\n      return\n    }\n\n    const result = window.confirm('Are you sure you want to delete expanse')\n    if (!result) {\n      return result\n    }\n\n    setError(undefined)\n    setIsDeleting(true)\n    try {\n      await client.deleteExpense(id)\n    } catch (e) {\n      setError(e)\n    } finally {\n      isMounted && setIsDeleting(false)\n      history.push('/expenses')\n    }\n  }, [expense, id, history, isMounted])\n\n  const handleShowAll = useCallback(() => {\n    history.push('/expenses')\n  }, [history])\n\n  return (\n    <>\n      <SectionHeader\n        title={`Expenses from ${\n          expense && expense.vendorName ? expense.vendorName : '...'\n        }`}\n      >\n        {expense && expense.status === ExpenseStatus.UNPAID ? (\n          <ButtonContainer>\n            <StyledButton onClick={handlePay}>Pay</StyledButton>\n            <StyledButton onClick={handleDelete} backgroundColor=\"#cd444a\">\n              Delete {isDeleting && <Spinner size=\"sm\" />}\n            </StyledButton>\n          </ButtonContainer>\n        ) : (\n          <StyledButton onClick={handleShowAll}>Show all expenses</StyledButton>\n        )}\n      </SectionHeader>\n      {error && <ErrorPanel text={error.message} />}\n      {expense ? (\n        <div>\n          <InfoItem\n            title={'Status'}\n            info={\n              <StatusInfoContainer>\n                <StatusInfo>{capitalize(expense.status)}</StatusInfo>\n                {(expense.status === ExpenseStatus.ANALYZING || isLoading) && (\n                  <Spinner size=\"sm\" />\n                )}\n              </StatusInfoContainer>\n            }\n          />\n          <InfoItem title={'Vendor'} info={expense.vendorName} />\n          <InfoItem title={'Amount'} info={expense.amount} />\n          <InfoItem\n            title={'Date'}\n            info={\n              expense.createdAt && new Date(expense.createdAt).toLocaleString()\n            }\n          />\n          <InfoItem title={'Filename'} info={expense.filename} />\n        </div>\n      ) : (\n        <Spinner />\n      )}\n    </>\n  )\n}\n\nexport default ExpenseItemRoute\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}